# AgentKit Runtimeï¼šä»æœ¬åœ°åˆ°äº‘ç«¯çš„ Agent éƒ¨ç½²åˆ©å™¨

**AgentKit Runtime** æ˜¯ä¸€ä¸ªç»Ÿä¸€çš„ã€æ‰˜ç®¡å¼çš„ **Agent** è¿è¡Œç¯å¢ƒï¼Œæ—¨åœ¨ä¸ºæ‚¨æä¾›ä¸€ä¸ªå®‰å…¨ã€é«˜æ•ˆã€å¯æ‰©å±•çš„ Serverless å¹³å°ï¼Œè®©æ‚¨èƒ½ä¸“æ³¨äº **Agent** çš„ä¸šåŠ¡é€»è¾‘ï¼Œè€Œéç¹ççš„åº•å±‚è¿ç»´ã€‚

## AgentKit Runtime ä¸ºæ‚¨è§£å†³ä»€ä¹ˆï¼Ÿ

-   **è¿ç»´è´Ÿæ‹…é‡**ï¼šæ‚¨æ˜¯å¦æ›¾ä¸ºç¯å¢ƒæ­å»ºã€ç½‘ç»œé…ç½®ã€ä¾èµ–å®‰è£…ã€æ‰‹åŠ¨æ‰©ç¼©å®¹å’Œæ•…éšœæ’æŸ¥è€Œè€—è´¹å¤§é‡ç²¾åŠ›ï¼Ÿ
-   **ç¼ºä¹ç»Ÿä¸€ç®¡ç†å¹³å°**ï¼šä¸ºä¸åŒçš„ **Agent** æˆ–ä¼šè¯åˆ›å»ºå’Œç®¡ç†ç‹¬ç«‹çš„è¿è¡Œç¯å¢ƒï¼Œæ˜¯å¦è®©æ‚¨æ„Ÿåˆ°è°ƒåº¦æ··ä¹±ã€éš¾ä»¥ç»´æŠ¤ï¼Ÿ
-   **å®‰å…¨ä¸éš”ç¦»æŒ‘æˆ˜**ï¼šæ‚¨æ˜¯å¦æ‹…å¿ƒå¤šç”¨æˆ·æˆ–å¤š **Agent** åœºæ™¯ä¸‹çš„æƒé™å†²çªã€æ•°æ®æ³„éœ²æˆ–æ¶æ„è®¿é—®é£é™©ï¼Ÿ
-   **ç›‘æ§ä¸æ—¥å¿—ç¼ºå¤±**ï¼šæ‚¨æ˜¯å¦éœ€è¦èŠ±è´¹é¢å¤–æˆæœ¬æ¥é…ç½®æ—¥å¿—ç³»ç»Ÿã€æŒ‡æ ‡æ”¶é›†å’Œå‘Šè­¦è§„åˆ™ï¼Œä»¥ä¾¿å®æ—¶ç›‘æ§ **Agent** çš„å¥åº·çŠ¶å†µï¼Ÿ

**AgentKit Runtime** é€šè¿‡æä¾›ä¸€ä¸ª Serverless çš„æ‰˜ç®¡ç¯å¢ƒï¼Œç³»ç»Ÿæ€§åœ°è§£å†³äº†ä»¥ä¸Šæ‰€æœ‰é—®é¢˜ã€‚


## æ ¸å¿ƒä¼˜åŠ¿

### 1. Serverless æ¶æ„ï¼šæè‡´ç®€åŒ–è¿ç»´ï¼Œä¼˜åŒ–æˆæœ¬

-   **é›¶åŸºç¡€è®¾æ–½ç®¡ç†**ï¼šæ— éœ€å…³å¿ƒåº•å±‚æœåŠ¡å™¨å’Œå¤æ‚çš„ç¯å¢ƒé…ç½®ï¼Œå®ç°çœŸæ­£çš„â€œä»£ç å³æœåŠ¡â€ã€‚
-   **ç»Ÿä¸€è¿è¡Œæ—¶å¹³å°**ï¼šåœ¨åŒä¸€ç¯å¢ƒä¸­é«˜æ•ˆè¿è¡Œå’Œè°ƒåº¦å¤šä¸ª **Agent** å®ä¾‹ï¼ˆSessionï¼‰ï¼Œå¹¶æä¾›ç»Ÿä¸€çš„æ¥å…¥ç‚¹ã€‚
-   **è‡ªåŠ¨åŒ–ç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼šæ ¹æ®å®æ—¶æµé‡ä»é›¶è‡ªåŠ¨æ‰©å±•åˆ°å¤§è§„æ¨¡å¹¶å‘ï¼Œå®ç°æ— äººå€¼å®ˆçš„å¼¹æ€§ä¼¸ç¼©ã€‚
-   **æŒ‰é‡ä»˜è´¹**ï¼šä»…åœ¨ **Agent** è¿è¡Œæ—¶äº§ç”Ÿè´¹ç”¨ï¼Œæ— æµé‡æ—¶èµ„æºè‡ªåŠ¨ç¼©å‡è‡³é›¶ï¼Œæœ€å¤§é™åº¦èŠ‚çœäº‘æˆæœ¬ã€‚
-   **å†…å»ºç›‘æ§ä¸æ—¥å¿—**ï¼šæä¾›å¼€ç®±å³ç”¨çš„å®æ—¶ç›‘æ§å’Œæ—¥å¿—ç³»ç»Ÿï¼Œè½»æ¾è¿½è¸ª **Agent** è¿è¡ŒçŠ¶æ€ï¼Œå¿«é€Ÿå®šä½é—®é¢˜ã€‚

### 2. ä¼ä¸šçº§å®‰å…¨éš”ç¦»

-   **å¤šé‡éš”ç¦»ä¿éšœ**ï¼šåŸºäºäº‘å‚å•†æˆç†Ÿçš„è™šæ‹ŸåŒ–å’Œå®¹å™¨æŠ€æœ¯ï¼Œç¡®ä¿æ¯ä¸ª **Agent Runtime** éƒ½åœ¨ç‹¬ç«‹ã€å—ä¿æŠ¤çš„ç¯å¢ƒä¸­è¿è¡Œã€‚
-   **ç²¾ç»†åŒ–æƒé™æ§åˆ¶**ï¼šä¸ **Identity** å’Œç½‘å…³é‰´æƒæ·±åº¦é›†æˆï¼Œä¸¥æ ¼éš”ç¦»ä¼šè¯ä¸Šä¸‹æ–‡ä¸è®¿é—®æƒé™ï¼Œæœ‰æ•ˆé˜²æ­¢æ•°æ®ä¸²æ‰°å’Œè¶Šæƒé£é™©ã€‚

### 3. æ¡†æ¶æ— å…³çš„å¿«é€Ÿé›†æˆ

-   **å¹¿æ³›çš„æ¡†æ¶æ”¯æŒ**ï¼šæ·±åº¦èåˆ **veADK**ï¼ŒåŒæ—¶å…¼å®¹ä¸»æµçš„ Python Agent æ¡†æ¶ï¼Œä»…éœ€å°‘é‡é€‚é…å³å¯å¿«é€Ÿæ¥å…¥ã€‚
-   **å¤šåè®®æ”¯æŒ**ï¼šåŸç”Ÿæ”¯æŒ HTTPã€MCPã€A2A ç­‰å¤šç§é€šä¿¡åè®®ï¼Œæ»¡è¶³ä¸åŒåº”ç”¨åœºæ™¯çš„éœ€æ±‚ã€‚
-   **ä¸€é”®éƒ¨ç½²**ï¼šé€šè¿‡ **AgentKit SDK**ï¼Œæ‚¨å¯ä»¥è½»æ¾å®ç°ä»æœ¬åœ° IDE åˆ°äº‘ç«¯ **Runtime** çš„ä¸€é”®éƒ¨ç½²ã€‚

---

## ä¸‰æ­¥ä¸Šæ‰‹ï¼šä»æœ¬åœ°å¼€å‘åˆ°äº‘ç«¯éƒ¨ç½²

æœ¬æŒ‡å—å°†å¼•å¯¼æ‚¨å®Œæˆä»ç¯å¢ƒé…ç½®ã€æœ¬åœ°å¼€å‘è°ƒè¯•ï¼Œåˆ°æœ€ç»ˆå°† **Agent** éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒçš„å…¨è¿‡ç¨‹ã€‚

### å‰ææ¡ä»¶

åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨å·²å‡†å¤‡å¥½ï¼š

1.  ä¸€ä¸ªå·²å¼€é€š **AgentKit** æœåŠ¡çš„ç«å±±å¼•æ“è´¦å·ï¼Œå¹¶è·å–å…¶ **AccessKey & SecretKey**ã€‚
    > **æç¤º**ï¼šè¯·ç¡®ä¿æ‚¨çš„ AccessKey æ‹¥æœ‰ `AgentKitFullAccess` æƒé™ã€‚
2.  æœ¬åœ°å·²å®‰è£… **Python 3.10+**ã€‚

### ç¬¬ 1 æ­¥ï¼šç¯å¢ƒé…ç½®

> æˆ‘ä»¬æ¨èä½¿ç”¨ `uv` æˆ– `python3 -m venv` æ¥ç®¡ç†æ‚¨çš„ Python è™šæ‹Ÿç¯å¢ƒã€‚ä»¥ä¸‹ç¤ºä¾‹å°†ä½¿ç”¨ `uv`ã€‚
> 
> `uv` å®‰è£…æŒ‡å—è¯·å‚è€ƒï¼š[uv installation](https://docs.astral.sh/uv/getting-started/installation/)

**1. åˆ›å»ºå¹¶æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ**

```bash
mkdir agentkit-runtime-quickstart
cd agentkit-runtime-quickstart
uv venv --python 3.12.0
source .venv/bin/activate
```

**2. å®‰è£…æ ¸å¿ƒä¾èµ–**

> æ‚¨å¯ä»¥é€šè¿‡ `--index` å‚æ•°æŒ‡å®šé•œåƒæºä»¥åŠ å¿«å®‰è£…é€Ÿåº¦ã€‚

```bash
uv pip install veadk-python
uv pip install agentkit-sdk-python
```

### ç¬¬ 2 æ­¥ï¼šåˆ›å»ºå¹¶æœ¬åœ°è°ƒè¯• Agent

#### 1. åˆå§‹åŒ– Agent é¡¹ç›®

æˆ‘ä»¬å¼ºçƒˆæ¨èæ‚¨ä½¿ç”¨ `agentkit-cli` æ¥å¿«é€Ÿå¯åŠ¨é¡¹ç›®ã€‚`init` å‘½ä»¤å¯ä»¥ä»æ¨¡æ¿åˆ›å»ºä¸€ä¸ªç»“æ„å®Œæ•´çš„ã€æ”¯æŒæµå¼è¾“å‡ºçš„ **Agent** é¡¹ç›®ã€‚

```bash
# ä½¿ç”¨ agentkit-cli ä»æ¨¡æ¿åˆ›å»ºé¡¹ç›®
agentkit init
```

è¿™ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªåŒ…å« `simple_agent.py` å’Œ `requirements.txt` çš„é¡¹ç›®ç»“æ„ï¼Œè®©æ‚¨èƒ½ç«‹å³å¼€å§‹å¼€å‘ã€‚

#### 2. æ™ºèƒ½ä½“ä»£ç æ¦‚è§ˆ

ä½¿ç”¨ `basic_stream` æ¨¡æ¿ç”Ÿæˆçš„ `simple_agent.py` æ ¸å¿ƒä»£ç å¦‚ä¸‹ã€‚å®ƒå±•ç¤ºäº†å¦‚ä½•åŸºäº **AgentkitSimpleApp** åŒ…è£…ä¸€ä¸ª **veADK** çš„ **Agent**ï¼Œå¹¶é€šè¿‡ **Runner** æ‰§è¡Œï¼Œæœ€ç»ˆä»¥ SSEï¼ˆServer-Sent Eventsï¼‰äº‹ä»¶æµè¿”å›ç»“æœã€‚

```python
# Copyright (c) 2025 Beijing Volcano Engine Technology Co., Ltd. and/or its affiliates.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

import json
import logging

from google.adk.agents import RunConfig
from google.adk.agents.run_config import StreamingMode
from google.genai.types import Content, Part
from veadk import Agent, Runner

from agentkit.apps import AgentkitSimpleApp
from veadk.prompts.agent_default_prompt import DEFAULT_DESCRIPTION, DEFAULT_INSTRUCTION

logger = logging.getLogger(__name__)
logger.setLevel(logging.INFO)

app = AgentkitSimpleApp()

app_name = "simple_streamable_app"

agent_name = "Agent"
description = DEFAULT_DESCRIPTION
system_prompt = DEFAULT_INSTRUCTION


tools = []

# from veadk.tools.builtin_tools.web_search import web_search
# tools.append(web_search)


agent = Agent(
    name=agent_name,
    description=description,
    instruction=system_prompt,
    tools=tools,
)
agent.model._additional_args["stream_options"] = {"include_usage": True}
runner = Runner(agent=agent, app_name=app_name)


@app.entrypoint
async def run(payload: dict, headers: dict):
    prompt = payload["prompt"]
    user_id = headers["user_id"]
    session_id = headers["session_id"]

    logger.info(
        f"Running agent with prompt: {prompt}, user_id: {user_id}, session_id: {session_id}"
    )

    session_service = runner.short_term_memory.session_service  # type: ignore

    # prevent session recreation
    session = await session_service.get_session(
        app_name=app_name, user_id=user_id, session_id=session_id
    )
    if not session:
        await session_service.create_session(
            app_name=app_name, user_id=user_id, session_id=session_id
        )

    new_message = Content(role="user", parts=[Part(text=prompt)])
    try:
        async for event in runner.run_async(
            user_id=user_id,
            session_id=session_id,
            new_message=new_message,
            run_config=RunConfig(streaming_mode=StreamingMode.SSE),
        ):
            # Format as SSE data
            sse_event = event.model_dump_json(exclude_none=True, by_alias=True)
            logger.debug("Generated event in agent run streaming: %s", sse_event)
            yield sse_event
    except Exception as e:
        logger.exception("Error in event_generator: %s", e)
        # You might want to yield an error event here
        error_data = json.dumps({"error": str(e)})
        yield error_data


@app.ping
def ping() -> str:
    return "pong!"


if __name__ == "__main__":
    app.run(host="0.0.0.0", port=8000)
```

**ä»£ç äº®ç‚¹**ï¼š
-   é»˜è®¤ä½¿ç”¨ç«å±±æ–¹èˆŸçš„è±†åŒ…æ¨¡å‹ï¼Œå¹¶è‡ªåŠ¨å¤„ç†æ¨¡å‹ API Key çš„è·å–ã€‚
-   å†…ç½®äº†ä¼šè¯ç®¡ç†é€»è¾‘ï¼Œç¡®ä¿å¤šè½®å¯¹è¯çš„è¿ç»­æ€§ã€‚
-   é€šè¿‡ `AgentkitSimpleApp` å®ç°äº†ä¸ **AgentKit Runtime** çš„æ— ç¼é›†æˆã€‚

#### 3. é…ç½®ç¯å¢ƒå˜é‡

åœ¨å¯åŠ¨ **Agent** æœåŠ¡ä¹‹å‰ï¼Œæ‚¨éœ€è¦é…ç½®ç«å±±å¼•æ“çš„è®¿é—®å‡­è¯ï¼š

```bash
# å¿…éœ€ï¼šé…ç½®æ‚¨çš„ç«å±±å¼•æ“è®¿é—®å‡­è¯
export VOLCENGINE_ACCESS_KEY=your_ak
export VOLCENGINE_SECRET_KEY=your_sk
```

> **é‡è¦æç¤º**ï¼šè¯·åŠ¡å¿…å°† `your_ak` å’Œ `your_sk` æ›¿æ¢ä¸ºæ‚¨çš„çœŸå®å‡­è¯ã€‚

#### 4. æœ¬åœ°å¯åŠ¨å¹¶è°ƒç”¨æœåŠ¡

ä¸€åˆ‡å°±ç»ªåï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨ **Agent** æœåŠ¡ï¼š

```bash
python simple_agent.py
```

æœåŠ¡å°†ç›‘å¬ `http://0.0.0.0:8000`ã€‚ç°åœ¨ï¼Œæ‰“å¼€å¦ä¸€ä¸ªç»ˆç«¯ï¼Œä½¿ç”¨ `curl` æ¥æµ‹è¯•æ‚¨çš„ **Agent**ï¼š

```bash
curl --location 'http://localhost:8000/invoke' \
  --header 'Content-Type: application/json' \
  --header 'user_id: test' \
  --header 'session_id: local_session' \
  --data '{"prompt": "è®²ä¸€ä¸ªç¬‘è¯ï¼"}'
```

**å‚æ•°è¯´æ˜ï¼š**

- `user_id`ï¼šç”¨æˆ·æ ‡è¯†ç¬¦
- `session_id`ï¼šä¼šè¯æ ‡è¯†ç¬¦
- `prompt`ï¼šç”¨æˆ·çš„è‡ªç„¶è¯­è¨€è¯·æ±‚

**æ‰§è¡Œæ—¥å¿—ç¤ºä¾‹: **

è°ƒç”¨æˆåŠŸåï¼Œæ§åˆ¶å°ä¼šè¾“å‡ºè¯¦ç»†çš„æ‰§è¡Œæ—¥å¿—ï¼š
```
INFO:     Started server process [38120]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     127.0.0.1:60807 - "POST /invoke HTTP/1.1" 200 OK
INFO:__main__:Running agent with prompt: è®²ä¸€ä¸ªç¬‘è¯ï¼, user_id: test, session_id: local_session
2025-12-01 20:12:50 | DEBUG | runner.py:151 - Event output: Why
2025-12-01 20:12:50 | DEBUG | runner.py:151 - Event output:  did
2025-12-01 20:12:50 | DEBUG | runner.py:151 - Event output:  the
2025-12-01 20:12:50 | DEBUG | runner.py:151 - Event output:  AI
2025-12-01 20:12:50 | DEBUG | runner.py:151 - Event output:  apply
2025-12-01 20:12:50 | DEBUG | runner.py:151 - Event output:  for
2025-12-01 20:12:50 | DEBUG | runner.py:151 - Event output:  a
2025-12-01 20:12:50 | DEBUG | runner.py:151 - Event output:  job
2025-12-01 20:12:50 | DEBUG | runner.py:151 - Event output:  at
2025-12-01 20:12:50 | DEBUG | runner.py:151 - Event output:  the
2025-12-01 20:12:51 | DEBUG | runner.py:151 - Event output:  bakery
2025-12-01 20:12:51 | DEBUG | runner.py:151 - Event output: ?
2025-12-01 20:12:51 | DEBUG | runner.py:151 - Event output: Because
2025-12-01 20:12:51 | DEBUG | runner.py:151 - Event output:  it
2025-12-01 20:12:51 | DEBUG | runner.py:151 - Event output:  wanted
2025-12-01 20:12:51 | DEBUG | runner.py:151 - Event output:  to
2025-12-01 20:12:51 | DEBUG | runner.py:151 - Event output:  work
2025-12-01 20:12:51 | DEBUG | runner.py:151 - Event output:  on
2025-12-01 20:12:51 | DEBUG | runner.py:151 - Event output:  its
2025-12-01 20:12:51 | DEBUG | runner.py:151 - Event output:  **
2025-12-01 20:12:51 | DEBUG | runner.py:151 - Event output: d
2025-12-01 20:12:51 | DEBUG | runner.py:151 - Event output: ough
2025-12-01 20:12:51 | DEBUG | runner.py:151 - Event output: **
2025-12-01 20:12:51 | DEBUG | runner.py:151 - Event output:  processing
2025-12-01 20:12:51 | DEBUG | runner.py:151 - Event output:  skills
2025-12-01 20:12:51 | DEBUG | runner.py:151 - Event output: !
2025-12-01 20:12:51 | DEBUG | runner.py:151 - Event output:  ğŸ˜„
2025-12-01 20:12:51 | DEBUG | runner.py:151 - Event output: Why did the AI apply for a job at the bakery?

Because it wanted to work on its **dough** processing skills! ğŸ˜„
```

### ç¬¬ 3 æ­¥ï¼šéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

å®Œæˆæœ¬åœ°å¼€å‘å’Œæµ‹è¯•åï¼Œæ‚¨å¯ä»¥å°†æ™ºèƒ½ä½“éƒ¨ç½²åˆ° AgentKit å¹³å°ï¼š

1. **æ‰“åŒ…ä»£ç **ï¼šç¡®ä¿æ‰€æœ‰ä¾èµ–éƒ½å·²æ­£ç¡®é…ç½®åœ¨ `requirements.txt` ä¸­ï¼Œä½¿ç”¨æ¨¡ç‰ˆç”Ÿæˆçš„ä»£ç é»˜è®¤å·²ç»åŒ…å«äº†æ‰€æœ‰å¿…è¦çš„ä¾èµ–ã€‚
2. **å¹³å°éƒ¨ç½²**ï¼šæ ¹æ®[å¿«é€Ÿå¼€å§‹]æŒ‡å—ï¼Œé€šè¿‡`agentkit config`å’Œ`agentkit launch`å‘½ä»¤ï¼Œé…ç½®å’Œéƒ¨ç½²åº”ç”¨ã€‚
3. **è°ƒç”¨åº”ç”¨**ï¼šéƒ¨ç½²å®Œæˆåï¼Œæ‚¨å¯ä»¥é€šè¿‡å¹³å°æä¾›çš„ API æˆ– SDK è°ƒç”¨æ™ºèƒ½ä½“ã€‚è°ƒç”¨ç¤ºä¾‹ï¼š
    ```bash
    agentkit invoke "è®²ä¸€ä¸ªç¬‘è¯ï¼"
    ```

è‡³æ­¤ï¼Œæ‚¨å·²æˆåŠŸå®Œæˆäº†ä»æœ¬åœ°å¼€å‘åˆ°äº‘ç«¯éƒ¨ç½²çš„å…¨è¿‡ç¨‹ï¼
